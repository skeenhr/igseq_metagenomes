---
title: "Renaming spades output to include sample ID the consolidating all contigs.fasta files for bowtie"
output: html_notebook
---

##This occurs after spades and before bowtie 

After spades (metaspades) there are folders for each original samples, labeled with the sample ID.  Inside of each folder are multiple files and additional folders that are the spades output. Specifically for this project we need the contigs.fasta file. 

BUT each file (within each folder) is identically named 'contigs.fasta'

Therefore we need to 1. rename this to include the sampleID and the move or copy/paste each contigs.fasta file to a separate folder for bowtie analysis. There's probably better way that copy/pasting the files but I can't get that to work. 

In this project, each sample is named some sort of iteration of EP##_# or EP##_## (e.g. EP90_1 or EP88_53). Therefore the folders are named EP90_1 or EP88_53 and we want to rename the contigs files to EP90_1_contigs.fasta or EP88_53_contigs.fasta. 

##Rename files in spades output folders
Note: This will only rename the FILES in the the directory, not any of the folders or files within those folders. But the code can be modified to change that if needed (-maxdepth)
Step 1: Navigate to the directory that includes all of the spades output folders
Step 2: load this file into that folder
Step 3: Run chmod +x folder_files_rename.sh 
Step 4: run ./folder_files_rename.sh

```{r folder_files_rename}
#!/bin/bash

###This script will append file names within a folder
###Specifically, I am using this on the metaspades output folders.  While each folder is named for the original sampleID, all files within the folder are identically names.  For example each folder contains a files called contigs.fasta.  I need these files to be uniquely named. The below script will append the name to EP##_##_contigs.fasta

#1. Add this script to the directory containing all spades folder outputs
#2. chmod +x folder_files_rename.sh
#2. Run script with ./folder_files_rename.sh


find EP* -type d | while read folder; do 
    folder_name=$(basename "$folder")
    find "$folder" -maxdepth 1 -type f | while read file; do 
        mv "$file" "$folder/${folder_name}_$(basename "$file")"
    done
done

###parent folder is the folder with all of the spades output folders
```


##Move (copy/paste) the renamed contigs.fasta files in spades output folders
Note: 

Step 1: Navigate to the directory that includes all of the spades output folders
Step 2: load this file into that folder
Step 3: Run chmod +x folder_files_rename.sh 
Step 4: run ./folder_files_rename.sh


```{r move_fasta_contigs.sh}
#!/bin/bash

###this is a script to copy and paste all contigs.fasta files from the spades output from their original folder into a separate folder
###BEFORE THIS STEP do run the folder_files_rename.sh script so that each contigs.fasta file is uniquely named with the SampleID

# Define the destination folder
destination_folder="ms_output_contigs"

# Create the destination folder if it doesn't exist
mkdir -p "$destination_folder"

# Loop through directories matching EP##_#_ms or EP##_##_ms
for dir in EP??_? EP??_??; do
    if [ -d "$dir" ]; then
        # Find the corresponding contigs file
        file="$dir/${dir%_ms}_contigs.fasta"
        if [ -f "$file" ]; then
            # Copy the file to the destination folder
            cp "$file" "$destination_folder/"
            echo "Copied $file to $destination_folder"
        else
            echo "File $file not found in $dir"
        fi
    fi
done


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
